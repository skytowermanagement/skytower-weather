// --- 気温（今日/明日）
// 詳細(d0)に今日が無い回があるので、週間(data[1])で補完する
const todayStr = ymd(new Date());
const tomoStr  = ymd(new Date(Date.now() + 24*60*60*1000));

function getTempsFromWeekly(dateStr) {
  const d1 = data[1]; // 週間予報
  if (!d1?.timeSeries?.length) return null;

  // 週間の気温はだいたい timeSeries[1] に入る（tempsMin/tempsMax）
  const ts = d1.timeSeries.find(x => x?.areas?.[0]?.tempsMin && x?.areas?.[0]?.tempsMax) || d1.timeSeries[1];
  if (!ts?.timeDefines?.length || !ts?.areas?.length) return null;

  const idx = findAreaIndex(ts, AREA_TEMP); // "東京"
  const a = (idx >= 0 ? ts.areas[idx] : ts.areas[0]);
  const mins = a?.tempsMin || [];
  const maxs = a?.tempsMax || [];

  const i = ts.timeDefines.findIndex(td => ymd(parseJst(td)) === dateStr);
  if (i < 0) return null;

  const min = mins[i] ?? "--";
  const max = maxs[i] ?? "--";
  if (min === "--" && max === "--") return null;
  return { min, max };
}

let t0 = "-- / -- ℃";
let t1 = "-- / -- ℃";

// ① まずは詳細(d0)から（取れればそれが優先）
const tsTempDetail = d0.timeSeries?.[2];
if (tsTempDetail?.areas?.length) {
  const idxT = findAreaIndex(tsTempDetail, AREA_TEMP); // "東京"
  const aT = (idxT >= 0 ? tsTempDetail.areas[idxT] : tsTempDetail.areas[0]);
  const temps = aT?.temps || [];
  const td0 = tsTempDetail.timeDefines?.[0] ? ymd(parseJst(tsTempDetail.timeDefines[0])) : null;

  if (td0 === todayStr && temps.length >= 2) {
    const min = temps[0] ?? "--";
    const max = temps[1] ?? "--";
    t0 = `${max} / ${min} ℃`;
  }
  if (td0 === tomoStr && temps.length >= 2) {
    const min = temps[0] ?? "--";
    const max = temps[1] ?? "--";
    t1 = `${max} / ${min} ℃`;
  }
}

// ② 今日/明日が "--/--" のままなら、週間(data[1])で補完
if (t0.startsWith("--")) {
  const w = getTempsFromWeekly(todayStr);
  if (w) t0 = `${w.max} / ${w.min} ℃`;
}
if (t1.startsWith("--")) {
  const w = getTempsFromWeekly(tomoStr);
  if (w) t1 = `${w.max} / ${w.min} ℃`;
}

document.getElementById("t0").textContent = t0;
document.getElementById("t1").textContent = t1;
